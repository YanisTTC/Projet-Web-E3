<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Stud’Path - Find student residences and universities with ease">
    <meta name="author" content="Your Name">
    <title>Stud'Path</title>

    <!-- CSS Stylesheets -->
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/map.css">

    <!-- Leaflet.js (Map Library) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
    <style>
        #map { width: 600px; height: 600px; }
    </style>

    <!--Lien JS Leaflet (toujours après le lien CSS)-->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    
    <script>
        "use strict";

        async function getEcoles() {

            let rep = await fetch("/fr-esr-principaux-etablissements-enseignement-superieur@mesr.geojson")
        
            if (!rep.ok) {
                throw Error(rep.statusText);
            }
            console.log(rep.status);

            let json = await rep.json();
            console.log(json);

            return json;

        }
        
        window.onload = async () => {
        /*Crée un layer avec les tuiles OpenStreetMap*/
        let layer = L.tileLayer('https://tiles.stadiamaps.com/tiles/osm_bright/{z}/{x}/{y}{r}.{ext}', {
            maxZoom: 15,
            attribution: '&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a> &copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a> &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            ext: 'png'
        });

        /*Crée une map affichée dans le layer précédent, avec un zoom de 9 sur les coordonnées spécifiées*/
        let map = L.map('map', {
            center: [48.6686111, 2.843888888888889],
            zoom: 9,
            layers: [layer]
        });

        /*Crée un marqueur sur les coordonnées spécifiées*/
        let marker = L.marker([48.6266667, 2.9333333333333336],{title: 'Centre Géographique de Seine-et-Marne'}).addTo(map);
        /*Coordonnées du centre géographique de Seine et Marne (IGN Institut)*/

        let data = await getEcoles();
        
        /*
        function createCustomIcon (feature, latlng) {
            let myIcon = L.icon({
            iconUrl: 'essence_icon.png',
            shadowUrl: 'essence_icon.png',
            iconSize:     [35, 35], // width and height of the image in pixels
            shadowSize:   [35, 20], // width, height of optional shadow image
            iconAnchor:   [12, 12], // point of the icon which will correspond to marker's location
            shadowAnchor: [12, 6],  // anchor point of the shadow. should be offset
            popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
            })
            return L.marker(latlng, { icon: myIcon , title: "E10: " + feature.properties.e10_prix + "€"})
        }*/

        /*
        function createCustomFilter(feature) {
            return feature.properties.e10_prix > 1.8 && feature.properties.id != 77140010 && feature.properties.id != 77140012;
        }*/

        /*
        let myLayerOptions = {
            pointToLayer: createCustomIcon,
            filter: createCustomFilter
        }
    
        */

        let ecoles = L.geoJSON(data).addTo(map);

        
        
        /*****************     Add markers to the map by clicking     *****************/
        
        // Initialize an array to keep track of all markers
        let markers = [];

        map.on('click', (event) => {
            // Retrieve the latitude and longitude from the click event
            let { lat, lng } = event.latlng;

            // Create and add a marker at the clicked location
            let newMarker = L.marker([lat, lng], { title: `Lat: ${lat}, Lng: ${lng}` }).addTo(map);

            // Add the new marker to the markers array
            markers.push(newMarker);
            
            // Add click event to the marker to remove it on the second click
            newMarker.on('click', function () {
                map.removeLayer(newMarker); // Remove marker from the map
            });
        
        });

        /*****************     Remove all markers by clicking on a button    *****************/

        function removeAllMarkers() {
            markers.forEach(marker => map.removeLayer(marker)); // Remove each marker from the map
            markers = []; // Clear the markers array
        }

        // Add a button to remove all markers
        let button = L.control({ position: 'topright' });
        button.onAdd = function () {
            let div = L.DomUtil.create('div', 'leaflet-bar leaflet-control leaflet-control-custom');
            div.style.backgroundColor = 'white';
            div.style.padding = '5px';
            div.style.cursor = 'pointer';
            div.innerHTML = 'Remove All Markers';
            div.onclick = removeAllMarkers; // Attach the removeAllMarkers function to the button click
            return div;
        };

        button.onAdd = function () {
            let div = L.DomUtil.create('div', 'leaflet-bar leaflet-control leaflet-control-custom');
            div.style.backgroundColor = 'white';
            div.style.padding = '5px';
            div.style.cursor = 'pointer';
            div.innerHTML = 'Remove All Markers';

            // Prevent map click events when interacting with the button
            L.DomEvent.on(div, 'click', function (e) {
                L.DomEvent.stopPropagation(e); // Stop click propagation
                removeAllMarkers(); // Call the function to remove all markers
            });

            return div;
        };

        button.addTo(map);

        }; 
    </script>

</head>
<body>
    <!-- Header Section -->
    <header>
        <nav>
            <h1>Stud’Path</h1>
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
        </nav>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Search Form -->
        <section class="search-section">
            <h2>Find Your Path</h2>
            <form id="search-form">
                <label for="search-type">Search by:</label>
                <select id="search-type" name="search-type">
                    <option value="residence">Student Residence</option>
                    <option value="address">Custom Address</option>
                    <option value="school">School</option>
                </select>
                <input type="text" id="search-input" placeholder="Enter your search term..." />
                <button type="submit">Search</button>
            </form>
        </section>

        <!-- Map Section -->
        <section id="map-section">
            <div id="map"></div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 Stud’Path. All rights reserved.</p>
    </footer>

    <!-- JavaScript Files -->
    <script src="assets/js/main.js"></script>
    <script src="assets/js/map.js"></script>
</body>
</html>
